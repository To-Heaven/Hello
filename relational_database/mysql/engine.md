# 表引擎


####  存储引擎是什么鬼?
- 数据库存储引擎其实就是实现数据存储, 为数据建立索引, 查找和修改数据的方法. 因为在关系数据库中数据的存储是以表的形式存储的，所以存储引擎也可以称为表类型（即存储和操作此表的类型）

> 一个database就是一个文件夹，而存放数据的表就是该文件夹下对应的文件
> 存储引擎其实就是一段代码程序，MySQL通过调用指定的存储引擎来对对应的数据库文件夹下的文件进行解析


![数据库结构、原理](https://github.com/ZiaWang/Hello/blob/master/picture/mysql.png?raw=true)


#### 常见的数据库引擎
- InnoDB
	- 应用范围比较广
	- 使用该引擎创建对应数据表之后，对应的数据库下会产生两个文件
		- 一个是`.fmt` 后缀的文件，存放着表的结构信息
		- 另一个是`.idb`后缀文件，存放着数据信息
- Myisam
	- 拥有较高的存储, 查询速度,但是不支持事务
	- 使用该请引擎创建一张表之后,对应的数据库中会产生三个文件
		- 一个是`.frm`后缀的文件,存放了表的结构信息
		- 一个是`.MYD`后缀的文件,存放的是表的数据信息
		- 一个是`.MYI`后缀的文件,存放的是表的索引信息
- memory
	- 创建的数据表存放在内存中，当服务端重新启动之后，该数据就会丢失，注意，是服务端而不是客户端，如果只是重启客户端，那么数据仍然还会存在
	- 用于创建临时数据表
		- 对应该数据库文件夹下只产生一个`.fmt` 文件
- blackhole
	- 用于回收数据库中不需要的数据，数据通过该引擎会被释放回收
	- 创建的文件同样是由`.fmt` 一个

#### 操作不同类型的表需要使用不同类型的引擎
- 举个例子
	- `.idb `存放的表数据。代表存放的是InnoDB引擎能够解析的数据，每创建一个表并指定引擎，MySQL就会在每次使用该表的时候调用对应引擎程序来操作存放该表的文件，**不同的表类型就由不同的存储引擎去处理**


#### InnoDB与Myisam的区别
1. InnoDB支持事务,Myisam不支持事务
2. InnoDB的数据安全粒度更细, 因为它支持行锁和表锁, 在并发链接状态下可以保证每一行数据的安全,而Myisam只支持表锁,数据安全性没有InnoDB高
	- 举例, 现在有A, B 两个员工,A的当前工资是10, B的当前工资是20, 现在要给两个人都增加10块钱的工资,那么就会去数据库的员工表中修改对应记录中工资字段的值, 就在修改的时候, CEO突然要给A再加10块, 如果这个时候也要操作表中A员工记录对应的工资字段值并且第一步的工资增加还没有写入数据表, 在没有使用`行锁`的情况下, 此时拿到的A记录的工资值将会是10, 而非20, 也就是说在没有使用`行锁`的情况下, 两次`被加数`都是`10`, 最后A的工资会是20而非30
3. InnoDB支持外键约束, 而MyISAM不支持外键约束
4. InnoDB不会保存表的行数(记录数), 这意味着当要获取表中的记录个数时,需要遍历整表, MyISAM中存储了表的行数, 获取表中记录个数时只需要直接读取保存好的值而非遍历整表

#### MyISAM与InnoDB之间的选择
> MySQL5.5之后默认使用InnoDB引擎, 之前是MyISAM


###### 选择InnoDB(事务性存储引擎)
1. 数据集比较庞大的时候 
	- InnoDB支持事务和故障恢复, InnoDB可以利用事务日志进行数据回复.
2. 更新操作密集的表

3. 事务

4. 外键约束
	- MySQL支持外键的存储引擎只有InnoDB

5. 自动增加列AUTO_INCREMENT属性

6. 自动灾难恢复。
	- 与其它存储引擎不同，InnoDB表能够自动从灾难中恢复。

###### 选择MyISAM
- 查询操作密集型的表
	- MyISAM存储引擎在筛选大量数据时非常迅速，这是它最突出的优点, 如果表的读操作远远多于写的操作并且不需要事务的支持, 选择MyISAM

- 插入操作密集型的表
	- `INSERT`批量插入的时候, MYISAM会快一些
	- MyISAM的并发插入特性允许同时选择和插入数据。例如：MyISAM存储引擎很适合管理邮件或Web服务器日志数据。


 