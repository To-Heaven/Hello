## HTTP协议  HyperText Teansfer Protocol
#### 什么是HTTP协议
> 协议本质上都是用来通信的

- 协议就是用来实现通信的，HTTP协议是Web客户端与服务端之间请求与应答的标准，它是基于TCP/IP协议实现的，是整个万维网数据通信的基础！


- 用三点来说明HTTP到底多牛
1.  **超文本传输协议**，可以传输任意类型的数据
2.  **客户端和服务端请求和应答的标准**。
3.  存在于TCP/IP五层模型的应用层，它是**整个万维网数据通信的基础**

###### user agent 与 origin server
- 通过使用**网页浏览器、网络爬虫或者其他工具**，由客户端发起一个HTTP请求到服务端指定的端口（默认80），服务端上存储客户端需要的数据资源，通过响应将数据传输给客户端，客户端与服务端之间可能存在多个"中间层"，比如代理服务器，网管、隧道。
	- 这个客户端就称为用户代理程序 ———— user agent
	- 服务端就是源服务器 ———— origin server

#### HTTP协议作用
- 客户端浏览器与万维网服务器之间互相通信的规则
- 保证计算机**正确快速的传输超文本数据**


#### 注意
- HTTP并不是只用于网页的浏览（主要应用）。协议的本质时进行通信，**只要建立链接的双方遵守这个协议，HTTP就可以进行数据的传输**（QQ，迅雷）
- HTTP传输数据是基于TCP/IP协议的



## HTTP 与 TCP
> TCP是一个端口到端口的、面向链接的协议，因此可以理解为**进程之间的通信**

- HTTP协议基于TCP协议进行数据传输。
	- HTTP协议中，客户端要实现与服务端之间数据的超文本传输，**需要通过TCP建立客户端与服务端之间的双向链接(三次握手与四次挥手)**
	- socket套接字是TCP/UDP网络通信的基本操作单元，**套接字本身不是协议，而是一个调用接口API**。从编程的角度来看，socket套接字是对TCP/UDP协议的封装和应用，包含网络通信的五种必须信息
		- 协议： TCP/UDP协议
		- 本地主机IP
		- 本地进程端口
		- 目标主机IP
		- 目标主机端口





## HTTP协议的特点
- 灵活的面向对象协议，可以传输任意类型的数据
	- HTTP协议传输的是一个个数据对象，这些数据对象可以是任意类型，用Content-Type标识

- 简单快速
	- 客户端只需要提供请求方法和请求路径，而且HTTP协议简单，使得服务端的程序规模小，所以通讯比较快。

- 无连接
	- 1.0
		- 每次基于TCP三次握手建立connection只能处理一次客户端的请求，服务端返回response响应之后就断开connection（网上诸多文章说1.0版本的连接方式可以节省时间，但是我认为这个特点反而会产生更多的IO操作，浪费时间）
	- 1.1
		- 由于每次建立connection都要基于TCP三次握手建立链接，这个过程存在IO，而且浪费服务器的性能。 1.1版本中一次请求响应之后不会立马断开连接，有一个默认等待时间（这段时间内，服务端会一直监听建立的链接） 
> 无连接本质上体现在socket请求响应断开




- 无状态
	- 无状态，保存状态即是对任务或事件的进度的保存，以便下次从保存位置继续开始该任务或事件。HTTP无状态就是指HTTP对事物处理的整个过程都不会对该事件状态进行保存的
		- 缺点： 如果HTTP协议后续处理需要前面任务或事件的信息，就必须重传，这回导致每次链接传送的数据量变得更大
		- 优点，如果服务器后续处理事件并不需要先前事件的信息，那么服务器的应答效率会提高
 
- 支持客户端/服务器模式。支持基本认证和安全认证



## 基于HTTP客户端/服务端通信流程
1. 客户端与服务端建立连接，这个链接是基于TCP协议来完成的
2. 建立完连接之后，客户端向服务端发送特定方法的请求。
3. 服务端接收到客户端的请求信息之后，验证该请求，并返回一个响应信息
4. 客户端接收服务端返回的相应信息，然后客户端与服务端之间断开链接（分协议版本）




## 不同HTTP协议版本之间的区别
### 1.0 与 1.1
##### 连接
- HTTP1.0需要通过`keep-alive`参数来告知服务器建立一个长连接
- HTTP1.1中，默认支持长连接
##### 带宽
- HTTP1.1支持只发送头信息header，服务器接收到头信息，判断客户端的请求是否有访问数据的权限，如果有权限就会向客户端返回一个100状态码，否则就返回401状态码。这样客户端可以通过接收到的响应状态码来判断是否要进行请求体body内容的传输，节省了带宽

##### host域
- 1.1 中，web 服务端通过host域可以让多个虚拟站点访问同一个ip和端口。在1.0中不支持该参数

### 1.1与2.0
##### 多路复用
- 2.0版本中通过TCP建立的同一个链接可以并发处理多个请求，并且并发请求的数量远远多于1.0版本
- 1.1版本只能通过建立多个TCP链接来处理更多并发的请求。每创建一个TCP链接是需要耗费时间和服务器性能的。

> TCP链接有一个预热和保护的过程，传输数据过程中，服务端会检查数据是否传输成功，一旦之前有传输成功的记录，服务器就会慢慢加大传输速度。如果通过1.1中建立多个链接处理请求，服务器相应的速度会变慢，因此最好充分利用已经建立好的链接来完成客户端请求的处理。

##### 数据量大小
- 2.0版本支持了对header部分的压缩传输（HPACK算法），1.1不支持

##### 服务端推送
- 对于支持2.0版本的web服务器，客户端请求数据时，服务端会顺便把客户端可能需要的其他数据一起发送到客户端，这些数据保存在客户端本地，因此非常适合加载竞静态文件



## URL Uniform Resource Locator
- URL统一资源定位符，用来描述网络上的资源
- 格式
	- `scheme://host[:port]/path/../[;url-params][?QueryString][#anchor]`
		- parameters
			- scheme: 使用的协议名称如HTTP、ftp、等
			- host： 服务器IP地址或域名
			- port： 端口，默认80
			- path： 要访问资源的路径
			- url-params: url参数
			- QueryString： 要发送给服务端的数据（GET请求）
			- anchor： 锚

- 举例
	- `http://www.ziawang.com/python/re/test;id=5689?name=ziawang&password=pass#stuff`

## HTTP协议本质
#### 基于socket套接字实现的通讯协议

###### GET请求
```
socket = socket.socket()

conn, _ = socket.connect((ip, port))

conn.send(b'GET http://www.xxx.com/?name=xxx&age=xxx HTTP1.1\r\nContent-Type:xxx&User-Agent:xxx\r\n\r\n')
```


###### POST请求

```
socnket = socket.socket()

conn, _ = socket.connect((ip, port))

...

conn.send(b'GET http://www.xxx.com/?name=xxx&age=xxx HTTP1.1\r\nContent-Type:xxx&User-Agent:xxx\r\n\r\nname=ziawang&password=pass')
```